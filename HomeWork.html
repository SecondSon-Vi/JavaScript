<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./HW.css">
    <link rel="stylesheet" href="common.css">
    <title>JS-Learning</title>
</head>
<body>

    <div class="test-wrapper">

        <h1 class="test-title">Арифметический тест</h1>

        <button class="begin-test-button">Начать тест</button> 
        <!--    при нажатии скрывается и показывает блок quiz-wrapper   -->

<br>

        <!--    пока тест не начат блок скрыт   -->

        <div class="quiz-wrapper">
            <div class="question-title">Вопрос</div>
                <!--  Задаем в JS  -->
            <div class="quiz-answers">
                <ul class="options-list">
                    <!--  Задаем в JS  -->
                </ul>

                <!--
                Введите ответ: <input type="text" class="answer-free">
                <input type="submit">
                -->
            </div>

            <div class="quiz-total"></div>

            <button class="next-question-button">Следующий вопрос</button>
        </div>
    </div>
    
    <div class="test-results hidden"> <!--   убери hidden потом  -->
        <button class="reset-test-button">Перезапустить тест</button> // станет доступна по завершению теста
        <div class="result-text">Результаты</div>   // отобразиться по завершению теста
        <div class="result-score">Результаты</div>
    </div>


    <script src="./questions.js"></script>

    <script>

        // Начало работы теста

        const beginTest = document.querySelector('.begin-test-button');
        const quizWrapper = document.querySelector('.quiz-wrapper');

        beginTest.addEventListener('click', () => {
            beginTest.style.display = 'none';
            quizWrapper.style.display = 'block';

            console.log("закрыл кнопку - открыл поле с ответами, кнопку для перехода на след вопрос");
        })



        // Отображение данных из массива

       // const quiz = document.querySelector('quiz-wrapper');
        const nextButton = document.querySelector('.next-question-button');

        let count = 0;
        let userScore = 0;

        showQuestions(count);

        function showQuestions(index){
            const question = document.querySelector('.question-title');
            const options = document.querySelector('.options-list');
            const total = document.querySelector('.quiz-total');

            question.innerHTML = `${questions[index].question}`;
            options.innerHTML = '';
            questions[index].options.forEach(item => {
                const text = `<li class="quiz-option">${item}</li>`;
                options.insertAdjacentHTML("beforeend", text)
            });

            // Выбор конкретного варианта ответа

            const optionsList = options.querySelectorAll('.quiz-option');
            optionsList.forEach(item => item.setAttribute('onclick', 'optionSelected(this)'));


            // Отображение на каком мы вопросе

            total.innerHTML = `${index + 1} из ${questions.length}`;
        }

        // Выбор ответа

        function optionSelected(answer) {
            const userAnswer = answer.textContent;
            const correctAnswer = questions[count].answer;
            const options = document.querySelectorAll('.quiz-option');

            if (userAnswer == correctAnswer) {
                userScore += 1;
                answer.classList.add('correct');
                //
            } else {
                answer.classList.add('incorrect');

                options.forEach(item => {
                    if (item.textContent == correctAnswer) {
                        setTimeout(() => {
                            item.classList.add('correct');
                        }, 100);
                    }
                });
            }
            
            options.forEach(item => item.classList.add('disabled'));
        }
        
        // Смена вопроса

        nextButton.addEventListener('click', nextQuestion);

        function nextQuestion() {
            const option = document.querySelector('.quiz-option');
            const testResults = document.querySelector('.test-results');
            const resultText = document.querySelector('.result-text');

            if ((count + 1) == questions.length && option.classList.contains('disabled')) {
                testResults.classList.remove('hidden');
                quizWrapper.style.display = 'none'; // quizWrapper.classList.add('hidden');
                resultText.innerHTML = `right questions: ${userScore} out of ${questions.length}`;
                    return;
            }


            if (option.classList.contains('disabled')) {
                count ++;
                showQuestions(count);

            } else {
                    alert("Choose the answer")
                }
        }

    </script>
    
</body>
</html>